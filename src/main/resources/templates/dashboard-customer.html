<!doctype html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout}"
>
  <head>
    <title>Customer Dashboard</title>
    <th:block layout:fragment="head-extra"></th:block>
  </head>
  <body>
    <div layout:fragment="content">
      <h1>Customer Dashboard</h1>
      <p>
        Welcome,
        <span th:text="${customer != null ? customer.name : principal.username}"
          >Customer</span
        >!
      </p>

      <div
        th:if="${errorMessage}"
        class="alert alert-danger"
        th:text="${errorMessage}"
      ></div>

      <div
        th:if="${customer != null and !customer.active}"
        class="alert alert-warning"
      >
        Your profile requires an approved bank account to access all features
        like applying for loans/FDs or viewing account details. Please wait for
        account approval or contact the bank.
      </div>

      <div th:if="${customer != null}">
        <div class="card">
          <div class="card-header">Your Accounts</div>
          <div class="card-body">
            <div th:if="${accounts == null or #lists.isEmpty(accounts)}">
              You currently have no active accounts.
            </div>
            <ul th:unless="${accounts == null or #lists.isEmpty(accounts)}">
              <li th:each="account : ${accounts}">
                <a th:href="@{/customer/account/{id}(id=${account.id})}">
                  <span th:text="${account.accountType}">Type</span> -
                  <span th:text="${account.accountNumber}">Number</span>:
                  Balance:
                  <span
                    th:text="${#numbers.formatCurrency(account.balance)}"
                  ></span>
                </a>
              </li>
            </ul>
          </div>
        </div>

        <div class="card">
          <div class="card-header">Your Loans</div>
          <div class="card-body">
            <div
              th:if="${loans == null or #lists.isEmpty(loans)}"
              style="
                display: flex;
                align-items: center;
                gap: 12px;
                flex-wrap: wrap;
              "
            >
              <span>You have no loan applications or active loans.</span>
              <a
                th:href="@{/customer/apply-loan}"
                class="btn btn-sm btn-primary"
                >Apply Now</a
              >
            </div>
            <table
              class="table table-sm table-striped"
              th:unless="${loans == null or #lists.isEmpty(loans)}"
            >
              <thead>
                <tr>
                  <th>Loan ID</th>
                  <th>Amount</th>
                  <th>Term</th>
                  <th>Rate (%)</th>
                  <th>Requested On</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="loan : ${loans}">
                  <td th:text="${loan.id}">L1</td>
                  <td th:text="${#numbers.formatCurrency(loan.loanAmount)}">
                    1000
                  </td>
                  <td th:text="${loan.termMonths + ' months'}">12 months</td>
                  <td th:text="${loan.interestRate}">8.5</td>
                  <td
                    th:text="${#temporals.format(loan.requestedAt, 'yyyy-MM-dd')}"
                  >
                    Date
                  </td>
                  <td>
                    <span
                      th:switch="${loan.status?.name()}"
                      style="
                        display: inline-block;
                        min-width: 80px;
                        text-align: center;
                      "
                    >
                      <span
                        th:case="'PENDING'"
                        class="badge bg-warning text-dark"
                        style="padding: 4px 10px"
                        >Pending</span
                      >
                      <span
                        th:case="'APPROVED'"
                        class="badge bg-success"
                        style="padding: 4px 10px"
                        >Approved</span
                      >
                      <span
                        th:case="'ACTIVE'"
                        class="badge bg-success"
                        style="padding: 4px 10px"
                        >Active</span
                      >
                      <span
                        th:case="'REJECTED'"
                        class="badge bg-danger"
                        style="padding: 4px 10px"
                        >Rejected</span
                      >
                      <span
                        th:case="'CLOSED'"
                        class="badge bg-secondary"
                        style="padding: 4px 10px"
                        >Closed</span
                      >
                      <span
                        th:case="*"
                        class="badge bg-secondary"
                        style="padding: 4px 10px"
                        th:text="${loan.status}"
                        >Unknown</span
                      >
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
            <div
              th:if="${loans != null and !#lists.isEmpty(loans)}"
              style="margin-top: 16px"
            >
              <a
                th:href="@{/customer/apply-loan}"
                class="btn btn-sm btn-primary"
                >Apply for Another Loan</a
              >
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">Your Fixed Deposits</div>
          <div class="card-body">
            <div
              th:if="${fixedDeposits == null or #lists.isEmpty(fixedDeposits)}"
              style="
                display: flex;
                align-items: center;
                gap: 12px;
                flex-wrap: wrap;
              "
            >
              <span>You have no fixed deposit applications or active FDs.</span>
              <a
                th:href="@{/customer/apply-fd}"
                class="btn btn-sm btn-primary"
                >Apply Now</a
              >
            </div>
            <table
              class="table table-sm table-striped"
              th:unless="${fixedDeposits == null or #lists.isEmpty(fixedDeposits)}"
            >
              <thead>
                <tr>
                  <th>FD ID</th>
                  <th>Amount</th>
                  <th>Term</th>
                  <th>Rate (%)</th>
                  <th>Requested On</th>
                  <th>Maturity Date</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="fd : ${fixedDeposits}">
                  <td th:text="${fd.id}">FD1</td>
                  <td th:text="${#numbers.formatCurrency(fd.principalAmount)}">
                    5000
                  </td>
                  <td th:text="${fd.termMonths + ' months'}">6 months</td>
                  <td th:text="${fd.interestRate}">5.0</td>
                  <td
                    th:text="${#temporals.format(fd.requestedAt, 'yyyy-MM-dd')}"
                  >
                    Date
                  </td>
                  <td
                    th:text="${fd.maturityDate != null ? #temporals.format(fd.maturityDate, 'yyyy-MM-dd') : '-'}"
                  >
                    Maturity
                  </td>
                  <td>
                    <span
                      th:switch="${fd.status?.name()}"
                      style="
                        display: inline-block;
                        min-width: 80px;
                        text-align: center;
                      "
                    >
                      <span
                        th:case="'PENDING'"
                        class="badge bg-warning text-dark"
                        style="padding: 4px 10px"
                        >Pending</span
                      >
                      <span
                        th:case="'APPROVED'"
                        class="badge bg-info"
                        style="padding: 4px 10px"
                        >Approved</span
                      >
                      <span
                        th:case="'ACTIVE'"
                        class="badge bg-success"
                        style="padding: 4px 10px"
                        >Active</span
                      >
                      <span
                        th:case="'REJECTED'"
                        class="badge bg-danger"
                        style="padding: 4px 10px"
                        >Rejected</span
                      >
                      <span
                        th:case="'CLOSED'"
                        class="badge bg-secondary"
                        style="padding: 4px 10px"
                        >Matured/Closed</span
                      >
                      <span
                        th:case="*"
                        class="badge bg-secondary"
                        style="padding: 4px 10px"
                        th:text="${fd.status}"
                        >Unknown</span
                      >
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
            <div
              th:if="${fixedDeposits != null and !#lists.isEmpty(fixedDeposits)}"
              style="margin-top: 16px"
            >
              <a th:href="@{/customer/apply-fd}" class="btn btn-sm btn-primary"
                >Apply for Another FD</a
              >
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">Your Grievances</div>
          <div class="card-body">
            <div
              th:if="${grievances == null or #lists.isEmpty(grievances)}"
              style="
                display: flex;
                align-items: center;
                gap: 12px;
                flex-wrap: wrap;
              "
            >
              <span>You have not filed any grievances.</span>
              <a
                th:href="@{/customer/file-grievance}"
                class="btn btn-sm btn-warning"
                >File Now</a
              >
            </div>
            <table
              class="table table-sm table-striped"
              th:unless="${grievances == null or #lists.isEmpty(grievances)}"
            >
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Subject</th>
                  <th>Submitted</th>
                  <th>Status</th>
                  <th>Resolved</th>
                  <th>Handled By</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="grievance : ${grievances}">
                  <td th:text="${grievance.id}">G1</td>
                  <td th:text="${grievance.subject}">Subject</td>
                  <td
                    th:text="${#temporals.format(grievance.submittedDate, 'yyyy-MM-dd')}"
                  >
                    Date
                  </td>
                  <td>
                    <span
                      th:switch="${grievance.status?.name()}"
                      style="
                        display: inline-block;
                        min-width: 80px;
                        text-align: center;
                      "
                    >
                      <span
                        th:case="'PENDING'"
                        class="badge bg-warning text-dark"
                        style="padding: 4px 10px"
                        >Pending</span
                      >
                      <span
                        th:case="'APPROVED'"
                        class="badge bg-success"
                        style="padding: 4px 10px"
                        >Resolved</span
                      >
                      <span
                        th:case="*"
                        class="badge bg-secondary"
                        style="padding: 4px 10px"
                        th:text="${grievance.status}"
                        >Unknown</span
                      >
                    </span>
                  </td>
                  <td
                    th:text="${grievance.resolvedDate != null ? #temporals.format(grievance.resolvedDate, 'yyyy-MM-dd') : '-'}"
                  >
                    Resolved Date
                  </td>
                  <td th:text="${grievance.handledByUsername ?: '-'}">
                    Staff/Manager
                  </td>
                </tr>
              </tbody>
            </table>
            <div
              th:if="${grievances != null and !#lists.isEmpty(grievances)}"
              style="margin-top: 16px"
            >
              <a
                th:href="@{/customer/file-grievance}"
                class="btn btn-sm btn-warning"
                >File New Grievance</a
              >
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">Other Services</div>
          <div class="card-body">
            <a th:href="@{/customer/profile/update}" class="btn btn-secondary"
              >Request Profile Update</a
            >
          </div>
        </div>
      </div>
    </div>
    <th:block layout:fragment="scripts-extra"></th:block>
  </body>
</html>
